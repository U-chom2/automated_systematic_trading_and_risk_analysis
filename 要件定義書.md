# **AIデイトレードシステム設計書**

## **カタリスト駆動型 リアルタイム取引システム**

### **1\. はじめに**

#### **1.1. プロジェクト目的**

本プロジェクトは、少額の自己資金を元手に、現代版「わらしべ長者」を実現することを目的とする。主戦場をボラティリティの高い**東証グロース市場**に定め、AI技術を駆使して人間の感情と判断速度の限界を超えた超短期取引を実行し、指数関数的な資産増加を目指す。

#### **1.2. 本書の目的**

本書は、本システムの開発を担当するエンジニアが、プロジェクトの全体像、設計思想、および各モジュールの詳細仕様を正確に理解し、自律的に開発・実装を進めることを可能にするための技術設計書である。

### **2\. システム概要**

#### **2.1. 設計思想：定時分析・判定システム**

本システムは、未来の株価を**「予測」**するものではない。毎日16:15（取引終了後）に、その日の株価変動要因（カタリスト）を総合的に分析し、定義されたルールに基づき翌日の投資判断を**「決定」**し、厳格な資金管理ルールで**「実行」**する、**定時分析・判定システム**である。システムの優位性は、予測精度ではなく、1日の情報を網羅的に分析する包括性と判断の機械性、そして徹底したリスク管理にある。

#### **2.2. アーキテクチャ概要**

本システムは、大きく分けて以下の4つのコアモジュールで構成される。

* **DataCollector (データ収集モジュール):** 市場からあらゆる情報をリアルタイムで収集する。  
* **AnalysisEngine (分析エンジン):** 収集された情報を分析し、取引のトリガーと判断材料を生成する。  
* **ExecutionManager (執行管理エンジン):** 分析結果に基づき、取引の実行とリスク管理を担う。  
* **SystemCore (システム中核):** 各モジュールを統合し、全体のワークフローを管理する。

### **3\. 要件定義**

#### **3.1. 機能要件**

| ID | 要件名 | 詳細 |
| :---- | :---- | :---- |
| **FR-01** | **監視リスト管理** | フェーズ1で定義されたスクリーニング条件に基づき、監視対象となる銘柄リストを動的に生成・管理できること。 |
| **FR-02** | **定時データ収集** | 毎日16:15の定時実行時に、監視リスト内の銘柄に関し、以下の情報を収集できること。\<br\>- **IR/プレスリリース:** TDnet、各社HPの当日分データ\<br\>- **SNS投稿:** X (旧Twitter)の当日分投稿\<br\>- **掲示板投稿:** Yahoo\!ファイナンス掲示板の当日分投稿\<br\>- **株価/出来高:** その日の取引データ |
| **FR-03** | **カタリスト情報分析** | 16:15定時実行時に、以下の情報を総合的に分析できること。\<br\>- **IR情報分析:** 新規IR/プレスリリースの重要度評価\<br\>- **SNSセンチメント分析:** 当日のSNS言及数・センチメントの変化を統計的に評価 |
| **FR-04** | **総合分析機能** | 16:15定時実行時に、以下の分析を自動で実行できること。\<br\>- **重要度分析:** IR/ニュース本文を自然言語処理で解析し、事前定義したキーワードに基づき重要度をスコアリングする。\<br\>- **センチメント分析:** SNS/掲示板投稿のポジティブ・ネガティブ比率およびその\*\*変化率（勢い）\*\*を算出する。\<br\>- 市場環境分析: 日経平均、TOPIX、同セクター指数のトレンドを評価する。\<br\>- テクニカル分析: 移動平均線乖離率、RSI、出来高の急増など、過熱感を判定する。 |
| FR-05 | リスクモデル（NN） | テクニカル指標（ヒストリカル・ボラティリティ、ATR等）を入力とし、現在の市場環境に最適な\*\*損切り幅（%）\*\*を出力するニューラルネットワークモデルを搭載すること。 |
| FR-06 | ポジションサイジング | 総資金、FR-05で算出された損切り幅、現在株価に基づき、\*\*「1トレードの最大許容損失額が総資金の1%」\*\*となるよう、購入株数を自動計算できること。 |
| **FR-07** | **翌日朝一番取引執行** | 分析結果に基づき、翌日の市場開始時に証券会社のAPIと連携し、以下の注文を自動で実行できること。\<br\>- 新規買い注文（対象銘柄のみ）\<br\>- **OCO注文:** 約定と同時に、利益確定（TP）と損切り（SL）の売り注文を自動で発注する。 |
| **FR-08** | **ロギング・監視** | 全ての定時分析、分析結果、取引記録をログとして保存し、システムの稼働状況を監視できるダッシュボード機能を持つこと。 |

#### **3.2. 非機能要件**

| ID | 要件名 | 詳細 |
| :---- | :---- | :---- |
| **NFR-01** | **パフォーマンス** | **16:15定時実行開始から全分析完了までを30分以内**で処理すること。翌日の取引判断を確実に決定することを最優先とする。 |
| **NFR-02** | **可用性** | 毎日16:15の定時実行時間において**99.9%以上**の稼働率を維持すること。 |
| **NFR-03** | **セキュリティ** | 証券会社のAPIキーや個人情報は、暗号化された上で厳重に管理すること。外部からの不正アクセスを防止する措置を講じること。 |

### **4\. システム構成と技術スタック**

#### **4.1. モジュール構成**

* **DataCollector:**  
  * TdnetScraper: TDnetを定期的にスクレイピング。  
  * XStreamer: XのStreaming APIを利用し、キーワードに合致する投稿をリアルタイムに取得。  
  * PriceFetcher: 証券会社のリアルタイム株価APIに接続。  
* **AnalysisEngine:**  
  * NlpAnalyzer: IR本文やSNS投稿を解析。形態素解析にはGiNZA、センチメントモデルにはBERTの日本語事前学習モデルを推奨。  
  * TechnicalAnalyzer: TA-Lib等のライブラリを利用し、テクニカル指標を計算。  
  * RiskModel(NN): TensorFlowまたはPyTorchで構築。入力は過去60日間のHV、ATRなど。出力は最適損切りパーセンテージ。  
* **ExecutionManager:**  
  * OrderManager: 証券会社APIとのインターフェース。ポジションサイジング計算式を実装。  
  * PositionTracker: 現在のポジションとOCO注文の状態を管理。

#### **4.2. 推奨技術スタック**

* **言語:** Python 3.10+  
* **主要ライブラリ:**  
  * データ収集: Scrapy, Tweepy  
  * データ分析: Pandas, NumPy, scikit-learn  
  * 自然言語処理: Transformers, GiNZA  
  * 機械学習: TensorFlow / PyTorch  
  * テクニカル分析: TA-Lib  
* **データベース:** PostgreSQL (ログ保存), Redis (リアルタイムデータキャッシュ)  
* **インフラ:** Dockerによるコンテナ化、AWS EC2/GCP Compute Engine上でのデプロイを推奨。

### **5\. 各フェーズ詳細仕様**

#### **5.1. フェーズ2：定時データ収集・分析**

* **IR情報収集ロジック:** 毎日16:15に、TDnetおよび監視銘柄各社のHPから、当日発表された全IR/プレスリリースを収集。タイトルに「上方修正」「業務提携」「決算」等のS級キーワードが含まれているものを特に重要視。  
* **SNSセンチメント収集ロジック:** 毎日16:15に、銘柄ごとの当日ツイート数、掲示板投稿数、およびセンチメントを収集。過去同曜日の同時刻との比較で異常度を評価。

#### **5.2. フェーズ3：総合分析と翌日投資判断**

* **総合スコアリング:** 収集した全情報を分析し、各結果を点数化し、合計スコアで翌日の投資判断を行う。  
  * カタリスト重要度スコア (Max 50): IRキーワードに応じて加点（例: 上方修正=50, 業務提携=40）。  
  * センチメントスコア (Max 30): ポジティブ投稿率とその増加率から算出。  
  * 市場環境スコア (Max 20): セクター指数が上昇トレンドなら加点。  
  * **買い判断閾値:** 合計スコアが**80点以上**の場合のみ、フェーズ4へ移行。  
  * **フィルター条件:** テクニカル分析で**RSI \> 75** または **移動平均乖離率 \> \+25%** の場合は、スコアに関わらず取引を見送る。

#### **5.3. フェーズ4：翌日取引実行とリスク管理**

* **ポジションサイジング計算式の実装:**  
  \# capital: 総資金  
  \# risk\_per\_trade\_ratio: 1トレードの許容損失率 (例: 0.01)  
  \# entry\_price: 現在株価  
  \# stop\_loss\_percentage: RiskModel(NN)が出力した損切り幅 (例: 0.08)

  max\_loss\_per\_trade \= capital \* risk\_per\_trade\_ratio  
  stop\_loss\_price \= entry\_price \* (1 \- stop\_loss\_percentage)  
  risk\_per\_share \= entry\_price \- stop\_loss\_price

  \# risk\_per\_shareが0にならないように保護  
  if risk\_per\_share \<= 0:  
      return 0 \# 購入不可

  position\_size \= max\_loss\_per\_trade // risk\_per\_share

  \# 単元株数で丸める  
  position\_size \= (position\_size // 100\) \* 100   
  return position\_size

* **再エントリー禁止ルール:** 同一銘柄に対して、手仕舞い後**3取引時間**は新規エントリーを禁止する。

### **6\. システム実行スケジュール**

#### **6.1. 定時実行スケジュール**

* **毎日16:15:** システム定時実行開始
  * データ収集（IR情報、SNS情報、株価・出来高データ）
  * 総合分析（重要度分析、センチメント分析、テクニカル分析）
  * 翌日投資判断（スコアリング、フィルター適用）
  * 処理完了目標：16:45（30分以内）

* **翌営業日9:00:** 自動取引執行
  * 前日判断結果に基づく新規買い注文
  * OCO注文（利益確定・損切り）の自動設定

#### **6.2. システム稼働要件**

* **平日のみ稼働:** 東京証券取引所営業日に連動
* **祝日・年末年始対応:** 取引所休場日は自動停止
* **障害時対応:** メール通知・ログ保存による状況把握

### **7\. 開発ロードマップ**

1. **Step 1 (データ基盤):** DataCollectorモジュールを構築し、各データソースから安定して情報を収集・保存できる基盤を確立する。  
2. **Step 2 (分析エンジン):** AnalysisEngineのプロトタイプを開発。過去データを用いたバックテストを繰り返し行い、各分析モデルの有効性を検証・改善する。  
3. **Step 3 (リスクモデル):** RiskModel(NN)を開発し、バックテスト環境でその有効性を検証する。  
4. **Step 4 (ペーパートレード):** 証券会社APIと連携し、**実際のお金を使わないペーパートレード**でシステムの全機能をテスト。バグの洗い出しとパラメータの最終調整を行う。  
5. **Step 5 (実運用):** 全テストをクリア後、当初計画の1/10程度の少額資金で実運用を開始。パフォーマンスを監視しながら段階的に投入資金を増やす。